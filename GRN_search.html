<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>c4lab sg4 - GRN viz 2017/05/04 </title>
  <!-- load D3js -->
  <script type="text/javascript" src="./lib/d3plus.v1.9.8/js/d3.js"></script>
  <!-- load D3plus after D3js -->
  <script src="./lib/d3plus.v1.9.8/js/d3plus.js"></script>
  <!-- Vue.js 2.0 -->
  <script src="https://unpkg.com/vue/dist/vue.js"></script>
</head>

<body>
  <div id="app">
    <!-- Draw other file -->
    <span>Switch dataset: </span>
    <button type="radio" @click="changeFile('./data/GRN_1000.tsv')">1000 nodes</button>
    <button type="radio" @click="changeFile('./data/GRN_10000.tsv')">10000 nodes</button>
    <button type="radio" @click="changeFile('./data/GRNv1.0.0.tsv')">64598 nodes</button><br>
    <div><a :href="filepath">{{filepath}}</a></div>
    <a :href="id_path">{{id_path}}</a><hr>

    <!-- Search -->
    <span>Jump to node: </span>
    <input type="text" name="focus" v-model="focus" placeholder="How about R00430?">
    <button type="button" @click="redraw()">Find <span>{{ focus }}</span></button>
  </div>
  <!-- Randering Area -->
  <div id="viz"></div>

  <script>

  var htmlButton = "<a id='google' href='http://www.google.com' target='_blank'>Click here to go to Google</a>"

  const variables = {
    // visualization: {},
    filepath: './data/GRNv1.0.0.tsv',
    id_path: './data/id_properties.tsv',
    focus: 'T00015',
    ids: {},
    edges: {},
  }

  var vm = new Vue({
    el: '#app',
    data: variables,
    created: function() {
      d3.tsv(this.id_path, function(ids){
        d3.tsv(vm.filepath, function(edges){
          vm.draw(ids, edges)
          vm.ids = ids
          vm.edges = edges
        })
      })
    },
    methods: {
      changeFile: function(file) {
        vm.filepath = file
        vm.redraw()
      },
      draw: function(i, e) {
        document.getElementById("viz").innerHTML = ""
        // cast strength as number for proper label formatting
        e.forEach(function(d){
          d["strength"] = parseFloat(d["strength"])
        })

        /* Now here's where we actually create the network */
        vm.visualization = d3plus.viz()
        .id("id")              // set id to match on nodes
        .attrs(i)               // attrs e.g. names, colors etc.
        .container("#viz")            // container DIV to hold the viz
        .type("rings")                // visualization type
        .focus(vm.focus)  // center node on Beyonce
        .text("id")                // set text to display on nodes
        .edges({
          "value": e,             // set data for edges (default)
          "label": "strength",        // show edge labels
          "arrows": true              // show directional arrows
        })
        .tooltip(['Name', 'Organism', 'Ref'])
        // .tooltip({"html": htmlButton})
        .draw()                       // finally, draw the visualization!
      },
      redraw: function() {
        // Clear
        document.getElementById("viz").innerHTML = ""
        // Load data and Draw
        d3.tsv(vm.id_path, function(ids){
          d3.tsv(vm.filepath, function(edges){
            vm.draw(ids, edges)
          })
        })
      },
    }
  })

  </script>

</body>
